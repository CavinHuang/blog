<!DOCTYPE html><html lang=zh><head><meta charset=UTF-8><meta name=baidu-site-verification content=rqskM4bdtP><meta name=viewport content="device-width, initial-scale=1, maximum-scale=1,user-scalable=no"><title>webpack多页面配置记录-CavinHuang-不懂写故事的猫-http://blog.zukmb.cn</title><meta name=keywords content=前端学习,php学习,个人博客,HTML,CSS,JS><meta name=description content=cavinHuang个人博客，这里记录学习和生活的点滴！><meta name=google-site-verification content=zOYxWUgmeogC0qY76WLP0eWl8r9E8jk_qU927Ij7tbs><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5a4c3745fa28006f"></script><link rel=stylesheet href=/css/yoyo.css><link rel=icon href=/img/favicon.png><link rel=stylesheet href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css?version=1.3"><script src=//cdn.bootcss.com/jquery/3.2.1/jquery.min.js></script><script src=//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js></script><script src=https://cdn.bootcss.com/velocity/1.5.0/velocity.min.js></script></head><body></body></html><div class=app><div class=left-container><canvas id=cas></canvas><div class="left-layout-container pc"><div class=user-info><a href="/"><img src="https://avatars1.githubusercontent.com/u/24950299?s=460&amp;v=4"></a><div class=login-name>CavinHuang</div><div class=slog>来不及总结自己,愿天大地大,我独一无二!</div></div><ul class=other-site><li><img src=http://www.17sucai.com/preview/177065/2017-09-28/Mon9/static/img/github.png></li><li><img src=http://www.17sucai.com/preview/177065/2017-09-28/Mon9/static/img/weibo.png></li></ul><ul class=left-menu><li><a href=/archives>文章</a></li><li><a href=/categories>分类</a></li><li><a href=/tags>标签</a></li><li><a href=/about>关于</a></li></ul><div class=qq-group><span>读万卷书</span><span>行万里路</span></div><div class=copyright>@ 2017 - 2017 CavinHuang</div></div></div><div class="blog-container main-container" id=content-outer><div class=blog-list-container id=content-inner><article class=article-container id=post><div class=article-header><h1 class=article-title>webpack多页面配置记录</h1><div class=article-subtitle><div class="publish-time fl">发布时间:<span>2018/1/17 17:6:16</span></div><div class=categories>分类:<a href="/categories/前端开发/"><span>前端开发</span></a>/<a href="/categories/前端开发/webpack/"><span>webpack</span></a></div></div></div><div class=article-content><p>之前也写过webpack学习记录，项目中需要一个常用的webpack多页面配置，所以才动手，本着能写一行是一行的原则，开始了配置webpack之旅。<br><a id=more></a></p><h1 id=定目录结构><a href=#定目录结构 class=headerlink title=定目录结构></a>定目录结构</h1><p>首先我只需要开发环境（包含自动更新）和打包环境，初定的目录结构是这样的<br><img src=/webpack多页面配置记录/dir-1.png title=目录结构><br>app主要写业务代码，config里写webpack配置和一些打包、开发的配置，经过一番计较，最后根据自己习惯，目录结构如下：<br><img src=/webpack多页面配置记录/dir-2.png title=目录结构><br><figure class="highlight bash"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div><div class=line>4</div><div class=line>5</div><div class=line>6</div><div class=line>7</div><div class=line>8</div></pre></td><td class=code><pre><div class=line>app</div><div class=line>  -libs  <span class=comment># 第三方插件库，可以是css也可以是js，eg：jq</span></div><div class=line>  -static <span class=comment># 公共的静态资源文件夹</span></div><div class=line>  -temlates <span class=comment># 模板文件夹</span></div><div class=line>    -*** <span class=comment># 模块文件夹</span></div><div class=line>    -css <span class=comment># 当前模块独有的css文件需要在index.js中import</span></div><div class=line>    -html <span class=comment># 模板文件，计划支持html，pug两种模板语言</span></div><div class=line>    -index.js <span class=comment># 当前模块入口文件</span></div></pre></td></tr></table></figure></p><h1 id=配置webpack><a href=#配置webpack class=headerlink title=配置webpack></a>配置webpack</h1><p>按上面所说，建好文件后，在根目录新建webpack.config.js<br>然后全局安装webpack和webpack-dev-server<br><figure class="highlight stylus"><table><tr><td class=gutter><pre><div class=line>1</div></pre></td><td class=code><pre><div class=line>npm <span class=selector-tag>i</span> webpack webpack-dev-server -g</div></pre></td></tr></table></figure></p><p>然后局部安装<br><figure class="highlight q"><table><tr><td class=gutter><pre><div class=line>1</div></pre></td><td class=code><pre><div class=line>npm i webpack webpack-<span class=built_in>dev</span>-server --<span class=built_in>save</span>-<span class=built_in>dev</span></div></pre></td></tr></table></figure></p><p>这样我们的项目就可以引入webpack了，并且可以使用webpack-dev-server的相关功能了，webpack.config.js内容非常的简单，就是根据环境变量中指定的当前环境来加载不同的webpack配置即可：<br><figure class="highlight js"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div><div class=line>4</div><div class=line>5</div><div class=line>6</div></pre></td><td class=code><pre><div class=line><span class=comment>// 未指定这手动指定为生产环境</span></div><div class=line>process.env.NODE_ENV = process.env.NODE_ENV ? process.env.NODE_ENV : <span class=string>'product'</span>;</div><div class=line><span class=comment>// 获取环境命令，并去除首尾空格</span></div><div class=line><span class=keyword>const</span> env = process.env.NODE_ENV.replace( <span class=regexp>/(\s*$)|(^\s*)/ig</span>, <span class=string>""</span> );</div><div class=line><span class=comment>// 根据环境变量引用相关的配置文件</span></div><div class=line><span class=built_in>module</span>.exports = <span class=built_in>require</span>( <span class=string>`./config/webpack.config.<span class=subst>$&#123;env&#125;</span>.js`</span> )</div></pre></td></tr></table></figure></p><p>在config文件夹下分别新建webpack.config.dev.js和webpack.config.product.js分别代表开发环境的配置和生成打包文件的配置，考虑到很多配置都会相同，再建一个webpack.config.base.js用来写统一的配置。</p><p>webpack.config.dev.js和webpack.config.product.js的区别是一个runtime时的配置，一个文件生成的配置，简而言之，就是开发环境的不同是配置webpack-dev-server,生产环境是压缩，map等配置</p><p>webpack.config.base.js文件才是webpack配置的主菜，包括entry、output、modules、plugins等</p><h2 id=获得所有入口文件的文件夹><a href=#获得所有入口文件的文件夹 class=headerlink title=获得所有入口文件的文件夹></a>获得所有入口文件的文件夹</h2><figure class="highlight js"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div><div class=line>4</div><div class=line>5</div><div class=line>6</div><div class=line>7</div><div class=line>8</div><div class=line>9</div><div class=line>10</div><div class=line>11</div><div class=line>12</div></pre></td><td class=code><pre><div class=line><span class=function><span class=keyword>function</span> <span class=title>getEntryDir</span>(<span class=params></span>) </span>&#123;</div><div class=line>	<span class=keyword>let</span> globPath = <span class=string>'app/templates/**/*.'</span> + config.tplLang</div><div class=line>	<span class=comment>// (\/|\\\\) 这种写法是为了兼容 windows和 mac系统目录路径的不同写法</span></div><div class=line>	<span class=keyword>let</span> pathDir = <span class=string>'app(\/|\\\\)(.*?)(\/|\\\\)html'</span></div><div class=line>	<span class=keyword>let</span> files = glob.sync( globPath )</div><div class=line>	<span class=keyword>let</span> dirname, entries = []</div><div class=line>	<span class=keyword>for</span> ( <span class=keyword>let</span> i = <span class=number>0</span>; i &lt; files.length; i++ ) &#123;</div><div class=line>		dirname = path.dirname( files[ i ] )</div><div class=line>		entries.push( dirname.replace( <span class=keyword>new</span> <span class=built_in>RegExp</span>( <span class=string>'^'</span> + pathDir ), <span class=string>'$2'</span> ) )</div><div class=line>	&#125;</div><div class=line>	<span class=keyword>return</span> entries;</div><div class=line>&#125;</div></pre></td></tr></table></figure><h2 id=注入entry和生成HTMLWebpackPlugin><a href=#注入entry和生成HTMLWebpackPlugin class=headerlink title=注入entry和生成HTMLWebpackPlugin></a>注入entry和生成HTMLWebpackPlugin</h2><figure class="highlight js"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div><div class=line>4</div><div class=line>5</div><div class=line>6</div><div class=line>7</div><div class=line>8</div><div class=line>9</div><div class=line>10</div><div class=line>11</div><div class=line>12</div></pre></td><td class=code><pre><div class=line>getEntryDir()</div><div class=line>	.forEach( <span class=function>(<span class=params> page </span>) =&gt;</span> &#123;</div><div class=line>		<span class=keyword>let</span> moduleName = page.split( <span class=string>'/'</span> )</div><div class=line>		<span class=keyword>let</span> moduleNameStr = moduleName[ moduleName.length - <span class=number>1</span> ]</div><div class=line>		<span class=keyword>const</span> htmlPlugin = <span class=keyword>new</span> HTMLWebpackPlugin( &#123;</div><div class=line>			filename: <span class=string>`<span class=subst>$&#123;moduleNameStr&#125;</span>.html`</span>,</div><div class=line>			template: path.resolve( __dirname, <span class=string>`../app/<span class=subst>$&#123;page&#125;</span>/html/index.<span class=subst>$&#123;config.tplLang&#125;</span>`</span> ),</div><div class=line>			chunks: [ moduleNameStr, <span class=string>'vendors'</span> ],</div><div class=line>		&#125; );</div><div class=line>		HTMLPlugins.push( htmlPlugin );</div><div class=line>		Entries[ moduleNameStr ] = path.resolve( __dirname, <span class=string>`../app/<span class=subst>$&#123;page&#125;</span>/index.js`</span> );</div><div class=line>	&#125; )</div></pre></td></tr></table></figure><p>关于HTMLWebpackPlugin的用法，可以参照<a href=https://segmentfault.com/a/1190000007294861 target=_blank rel=external>html-webpack-plugin用法全解</a> 以及<a href=https://github.com/jantimon/html-webpack-plugin target=_blank rel=external>官方文档</a> 已经写的非常详尽了。</p><h3 id=第三方库入口自动获取><a href=#第三方库入口自动获取 class=headerlink title=第三方库入口自动获取></a>第三方库入口自动获取</h3><figure class="highlight js"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div><div class=line>4</div><div class=line>5</div><div class=line>6</div><div class=line>7</div><div class=line>8</div><div class=line>9</div><div class=line>10</div></pre></td><td class=code><pre><div class=line><span class=function><span class=keyword>function</span> <span class=title>getVendors</span>(<span class=params></span>) </span>&#123;</div><div class=line>	<span class=keyword>let</span> globPath = <span class=string>`app/<span class=subst>$&#123;config.libraryDir&#125;</span>/**/*.*`</span></div><div class=line>	<span class=keyword>let</span> files = glob.sync( globPath )</div><div class=line>	<span class=keyword>let</span> libsArr = []</div><div class=line>	files.forEach( <span class=function>(<span class=params> v, i </span>) =&gt;</span> &#123;</div><div class=line>		libsArr.push( <span class=string>'./'</span> + v )</div><div class=line>	&#125; )</div><div class=line>	<span class=keyword>return</span> libsArr</div><div class=line>&#125;</div><div class=line>Entries[ <span class=string>'vendors'</span> ] = getVendors() <span class=comment>// 第三方类库</span></div></pre></td></tr></table></figure><p>其中多页面入口和第三方库配置，请看这篇webpack中文站文档<a href=https://doc.webpack-china.org/concepts/entry-points/#-app-vendor- target=_blank rel=external>分离 应用程序(app) 和 第三方库(vendor) 入口</a></p><h3 id=output-配置><a href=#output-配置 class=headerlink title="output 配置"></a>output 配置</h3><figure class="highlight js"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div><div class=line>4</div></pre></td><td class=code><pre><div class=line>output: &#123;</div><div class=line>  filename: <span class=string>"static/js/[name].bundle.[hash].js"</span>,</div><div class=line>  path: path.resolve( __dirname, config.devServerOutputPath )</div><div class=line>&#125;</div></pre></td></tr></table></figure><h3 id=webpack配置合并><a href=#webpack配置合并 class=headerlink title=webpack配置合并></a>webpack配置合并</h3><p>主要用到一个webpack插件 webpack-merge，可把分开配置的config合并，分开生产环境和调试环境</p><p>最后奉上github地址: <a href=https://github.com/CavinHuang/webpack-multi-skeleton target=_blank rel=external>webpack-multi-skeleton</a>,有不对之处，请指正！</p></div><div id=side-right-bar><div class=close-right-bar></div><div class=sidebar-toc><div class=sidebar-toc__title>目录</div><div class=sidebar-toc__progress><span class=progress-notice>你已经阅读了</span><span class=progress-num>0</span><span class=progress-percentage>%</span><div class=sidebar-toc__progress-bar></div></div><div class=sidebar-toc__content><ol class=toc><li class="toc-item toc-level-1"><a class=toc-link href=#定目录结构><span class=toc-number>1.</span> <span class=toc-text>定目录结构</span></a></li><li class="toc-item toc-level-1"><a class=toc-link href=#配置webpack><span class=toc-number>2.</span> <span class=toc-text>配置webpack</span></a><ol class=toc-child><li class="toc-item toc-level-2"><a class=toc-link href=#获得所有入口文件的文件夹><span class=toc-number>2.1.</span> <span class=toc-text>获得所有入口文件的文件夹</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#注入entry和生成HTMLWebpackPlugin><span class=toc-number>2.2.</span> <span class=toc-text>注入entry和生成HTMLWebpackPlugin</span></a><ol class=toc-child><li class="toc-item toc-level-3"><a class=toc-link href=#第三方库入口自动获取><span class=toc-number>2.2.1.</span> <span class=toc-text>第三方库入口自动获取</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#output-配置><span class=toc-number>2.2.2.</span> <span class=toc-text>output 配置</span></a></li><li class="toc-item toc-level-3"><a class=toc-link href=#webpack配置合并><span class=toc-number>2.2.3.</span> <span class=toc-text>webpack配置合并</span></a></li></ol></li></ol></li></ol></div></div></div><div class=right-btn id=right-btn><span>目录</span></div><div class=article-bottom><div class="addthis_inline_share_toolbox fr"></div></div><div class=post-copyright><div class=post-copyright__author><span class=post-copyright-meta>文章作者:</span><span class=post-copyright-info><a href=mailto:undefined>CavinHuang</a></span></div><div class=post-copyright__type><span class=post-copyright-meta>文章链接:</span><span class=post-copyright-info><a href="http://blog.zukmb.cnwebpack多页面配置记录/">http://blog.zukmb.cnwebpack多页面配置记录/</a></span></div><div class=post-copyright__notice><span class=post-copyright-meta>版权声明:</span><span class=post-copyright-info>转载请注明来自<a href=http://blog.zukmb.cn target=_blank style="font-size: 18px;">CavinHuangのBlog</a>！</span></div></div><div class=article-pagenate><div class="article-prev fl"><span>←</span><a href="/一步一步完成一个node-cli/">一步一步完成一个node-cli</a></div><div class="article-next fr"><a href="/剑指offer-解题笔记/">《剑指offer》解题笔记</a><span>→</span></div></div></article></div><footer class=footer><div id=toTop style="display: none;">Back to Top</div></footer></div></div><canvas class=fireworks></canvas><script src=/js/velocity.ui.min.js></script><script src=/js/yoyo.js></script><script src=/js/scroll.js></script><script src=/js/particle.js></script><script src=/js/anime.min.js></script><script src=/js/fireworks.js></script>