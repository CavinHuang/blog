<!DOCTYPE html><html lang=zh><head><meta charset=UTF-8><meta name=baidu-site-verification content=rqskM4bdtP><meta name=viewport content="device-width, initial-scale=1, maximum-scale=1,user-scalable=no"><title>正则表达式解析一个完整的url-CavinHuang-不懂写故事的猫-http://blog.zukmb.cn</title><meta name=keywords content=前端学习,php学习,个人博客,HTML,CSS,JS><meta name=description content=cavinHuang个人博客，这里记录学习和生活的点滴！><meta name=google-site-verification content=zOYxWUgmeogC0qY76WLP0eWl8r9E8jk_qU927Ij7tbs><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5a4c3745fa28006f"></script><link rel=stylesheet href=/css/yoyo.css><link rel=icon href=/img/favicon.png><link rel=stylesheet href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css?version=1.3"><script src=//cdn.bootcss.com/jquery/3.2.1/jquery.min.js></script><script src=//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js></script><script src=https://cdn.bootcss.com/velocity/1.5.0/velocity.min.js></script></head><body></body></html><div class=app><div class=left-container><canvas id=cas></canvas><div class="left-layout-container pc"><div class=user-info><a href="/"><img src="https://avatars1.githubusercontent.com/u/24950299?s=460&amp;v=4"></a><div class=login-name>CavinHuang</div><div class=slog>来不及总结自己,愿天大地大,我独一无二!</div></div><ul class=other-site><li><img src=http://www.17sucai.com/preview/177065/2017-09-28/Mon9/static/img/github.png></li><li><img src=http://www.17sucai.com/preview/177065/2017-09-28/Mon9/static/img/weibo.png></li></ul><ul class=left-menu><li><a href=/archives>文章</a></li><li><a href=/categories>分类</a></li><li><a href=/tags>标签</a></li><li><a href=/about>关于</a></li></ul><div class=qq-group><span>读万卷书</span><span>行万里路</span></div><div class=copyright>@ 2017 - 2017 CavinHuang</div></div></div><div class="blog-container main-container" id=content-outer><div class=blog-list-container id=content-inner><article class=article-container id=post><div class=article-header><h1 class=article-title>正则表达式解析一个完整的url</h1><div class=article-subtitle><div class="publish-time fl">发布时间:<span>2018/3/17 19:46:10</span></div><div class=categories>分类:<a href="/categories/前端开发/"><span>前端开发</span></a></div></div></div><div class=article-content><blockquote><p>题目：解析一个完整的url,返回Object包含域与window.location相同<br><a id=more></a></p></blockquote><p>答案：<br><figure class="highlight js"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div><div class=line>4</div><div class=line>5</div><div class=line>6</div><div class=line>7</div><div class=line>8</div><div class=line>9</div><div class=line>10</div><div class=line>11</div><div class=line>12</div><div class=line>13</div><div class=line>14</div><div class=line>15</div><div class=line>16</div><div class=line>17</div><div class=line>18</div><div class=line>19</div><div class=line>20</div><div class=line>21</div><div class=line>22</div><div class=line>23</div><div class=line>24</div><div class=line>25</div><div class=line>26</div><div class=line>27</div><div class=line>28</div><div class=line>29</div><div class=line>30</div><div class=line>31</div><div class=line>32</div><div class=line>33</div><div class=line>34</div><div class=line>35</div><div class=line>36</div><div class=line>37</div><div class=line>38</div><div class=line>39</div><div class=line>40</div><div class=line>41</div><div class=line>42</div></pre></td><td class=code><pre><div class=line><span class=comment>/**</span></div><div class=line><span class=comment> * 解析一个url并生成window.location对象中包含的域</span></div><div class=line><span class=comment> * location:</span></div><div class=line><span class=comment> * &#123;</span></div><div class=line><span class=comment> *      href: '包含完整的url',</span></div><div class=line><span class=comment> *      origin: '包含协议到pathname之前的内容',</span></div><div class=line><span class=comment> *      protocol: 'url使用的协议，包含末尾的:',</span></div><div class=line><span class=comment> *      username: '用户名', // 暂时不支持</span></div><div class=line><span class=comment> *      password: '密码',  // 暂时不支持</span></div><div class=line><span class=comment> *      host: '完整主机名，包含:和端口',</span></div><div class=line><span class=comment> *      hostname: '主机名，不包含端口'</span></div><div class=line><span class=comment> *      port: '端口号',</span></div><div class=line><span class=comment> *      pathname: '服务器上访问资源的路径/开头',</span></div><div class=line><span class=comment> *      search: 'query string，?开头',</span></div><div class=line><span class=comment> *      hash: '#开头的fragment identifier'</span></div><div class=line><span class=comment> * &#125;</span></div><div class=line><span class=comment> *</span></div><div class=line><span class=comment> * @param &#123;string&#125; url 需要解析的url</span></div><div class=line><span class=comment> * @return &#123;Object&#125; 包含url信息的对象</span></div><div class=line><span class=comment> */</span></div><div class=line></div><div class=line></div><div class=line> <span class=function><span class=keyword>function</span> <span class=title>parseUrl</span>(<span class=params>url</span>) </span>&#123;</div><div class=line>    <span class=keyword>var</span> result = &#123;&#125;;</div><div class=line>    <span class=keyword>var</span> keys = [<span class=string>'href'</span>, <span class=string>'origin'</span>, <span class=string>'protocol'</span>, <span class=string>'host'</span>,</div><div class=line>                <span class=string>'hostname'</span>, <span class=string>'port'</span>, <span class=string>'pathname'</span>, <span class=string>'search'</span>, <span class=string>'hash'</span>];</div><div class=line>    <span class=keyword>var</span> i, len;</div><div class=line>    <span class=keyword>var</span> regexp = <span class=regexp>/(([^:]+:)\/\/(([^:\/\?#]+)(:\d+)?))(\/[^?#]*)?(\?[^#]*)?(#.*)?/</span>;</div><div class=line></div><div class=line>    <span class=keyword>var</span> match = regexp.exec(url);</div><div class=line>	 <span class=built_in>console</span>.info(<span class=string>'match='</span>, match);</div><div class=line></div><div class=line>    <span class=keyword>if</span> (match) &#123;</div><div class=line>        <span class=keyword>for</span> (i = keys.length - <span class=number>1</span>; i &gt;= <span class=number>0</span>; --i) &#123;</div><div class=line>            result[keys[i]] = match[i] ? match[i] : <span class=string>''</span>;</div><div class=line>        &#125;</div><div class=line>    &#125;</div><div class=line>	 <span class=built_in>console</span>.info(<span class=string>'result='</span>, result);</div><div class=line>    <span class=keyword>return</span> result;</div><div class=line>&#125;</div><div class=line></div><div class=line>parseUrl(<span class=string>"http://test.com:8080?name=1&amp;password=2#page1"</span>);</div></pre></td></tr></table></figure></p><p>结果：<br><figure class="highlight js"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div><div class=line>4</div><div class=line>5</div><div class=line>6</div><div class=line>7</div><div class=line>8</div><div class=line>9</div><div class=line>10</div><div class=line>11</div><div class=line>12</div><div class=line>13</div><div class=line>14</div><div class=line>15</div><div class=line>16</div><div class=line>17</div><div class=line>18</div><div class=line>19</div><div class=line>20</div><div class=line>21</div><div class=line>22</div><div class=line>23</div><div class=line>24</div><div class=line>25</div></pre></td><td class=code><pre><div class=line>match=[</div><div class=line>  <span class=string>'http://test.com:8080?name=1&amp;password=2#page1'</span>,</div><div class=line>  <span class=string>'http://test.com:8080'</span>,</div><div class=line>  <span class=string>'http:'</span>,</div><div class=line>  <span class=string>'test.com:8080'</span>,</div><div class=line>  <span class=string>'test.com'</span>,</div><div class=line>  <span class=string>':8080'</span>,</div><div class=line>  <span class=literal>undefined</span>,</div><div class=line>  <span class=string>'?name=1&amp;password=2'</span>,</div><div class=line>  <span class=string>'#page1'</span>,</div><div class=line>  index: <span class=number>0</span>,</div><div class=line>  input: <span class=string>'http://test.com:8080?name=1&amp;password=2#page1'</span></div><div class=line>]</div><div class=line></div><div class=line>result=&#123;</div><div class=line>  hash: <span class=string>'#page1'</span>,</div><div class=line>  search: <span class=string>'?name=1&amp;password=2'</span>,</div><div class=line>  pathname: <span class=string>''</span>,</div><div class=line>  port: <span class=string>':8080'</span>,</div><div class=line>  hostname: <span class=string>'test.com'</span>,</div><div class=line>  host: <span class=string>'test.com:8080'</span>,</div><div class=line>  protocol: <span class=string>'http:'</span>,</div><div class=line>  origin: <span class=string>'http://test.com:8080'</span>,</div><div class=line>  href: <span class=string>'http://test.com:8080?name=1&amp;password=2#page1'</span></div><div class=line>&#125;</div></pre></td></tr></table></figure></p><p>没错，一眼就看到了难以理解的是那段正则表达式：<br><figure class=highlight><table><tr><td class=gutter><pre><div class=line>1</div></pre></td><td class=code><pre><div class=line>/(([^:]+:)\/\/(([^:\/\?#]+)(:\d+)?))(\/[^?#]*)?(\?[^#]*)?(#.*)?/</div></pre></td></tr></table></figure></p><p>刚好最近看了精通正则表达式一书（的20%，哈哈看不完），刚好可以练练手了</p><ol><li>匹配的数组长度为11个，为什么</li><li>每一个是怎么匹配来的<figure class="highlight js"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div><div class=line>4</div><div class=line>5</div><div class=line>6</div><div class=line>7</div><div class=line>8</div><div class=line>9</div><div class=line>10</div><div class=line>11</div><div class=line>12</div><div class=line>13</div><div class=line>14</div><div class=line>15</div><div class=line>16</div><div class=line>17</div><div class=line>18</div><div class=line>19</div><div class=line>20</div><div class=line>21</div><div class=line>22</div><div class=line>23</div><div class=line>24</div></pre></td><td class=code><pre><div class=line>首先，在分析之前，先给大家补补基础概念，知道的就跳过</div><div class=line>?:  匹配<span class=number>0</span>个或一个</div><div class=line>*   匹配<span class=number>0</span>个或多个,</div><div class=line>+:  一次或多次，至少出现一次</div><div class=line>.*  贪婪匹配：在满足匹配时，匹配尽可能长的字符串，默认情况下，采用贪婪匹配（没有问号）</div><div class=line></div><div class=line><span class=comment>// 非贪婪匹配：在满足匹配时，匹配尽可能短的字符串，使用?来表示非贪婪匹配</span></div><div class=line>?  非贪婪，最小匹配（重点，后面会用到）</div><div class=line>*? 重复任意次，但尽可能少重复  </div><div class=line>+? 重复<span class=number>1</span>次或更多次，但尽可能少重复  </div><div class=line>?? 重复<span class=number>0</span>次或<span class=number>1</span>次，但尽可能少重复  </div><div class=line>&#123;n,m&#125;? 重复n到m次，但尽可能少重复  </div><div class=line>&#123;n,&#125;? 重复n次以上，但尽可能少重复  </div><div class=line></div><div class=line><span class=comment>//环视</span></div><div class=line><span class=string>'jeffs'</span>.replace(<span class=regexp>/(?&lt;=jeff)(?=s)/i</span>, <span class=string>'"'</span>)</div><div class=line><span class=comment>//顺序环视和逆向环视,?= 匹配的目标位置后紧跟s,匹配的目标位置前紧邻jeff  jeff目标s，结果输出：jeff"s</span></div><div class=line></div><div class=line>[^]: ^表示非 <span class=comment>//示例：[^u]</span></div><div class=line></div><div class=line><span class=comment>//[]里面的元字符只是普通字符</span></div><div class=line>/<span class=number>03</span>[-./]<span class=number>22</span>/.test(<span class=string>'03-22'</span>) 结果输出：<span class=literal>true</span></div><div class=line></div><div class=line><span class=comment>//() ：标记一个子表达式的开始和结束位置。子表达式可以获取供以后使用</span></div></pre></td></tr></table></figure></li></ol><p>进入正题，匹配的数组长度为11个，为什么？<br>因为匹配结果是按照()的个数和顺序决定的，重点是前面9个<br>最后两个[index: 0,input: ‘<a href="http://test.com:8080?name=1&amp;password=2#page1&#39;]是regexp.exec函数自带返回的" target=_blank rel=external>http://test.com:8080?name=1&amp;password=2#page1&#39;]是regexp.exec函数自带返回的</a><br>所以上面的表达式可以拆分为如下子表达式：</p><figure class=highlight><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div><div class=line>4</div><div class=line>5</div><div class=line>6</div><div class=line>7</div><div class=line>8</div><div class=line>9</div></pre></td><td class=code><pre><div class=line>(([^:]+:)\/\/(([^:\/\?#]+)(:\d+)?))(\/[^?#]*)?(\?[^#]*)?(#.*)?</div><div class=line>(([^:]+:)\/\/(([^:\/\?#]+)(:\d+)?))</div><div class=line>([^:]+:)</div><div class=line>(([^:\/\?#]+)(:\d+)?)</div><div class=line>([^:\/\?#]+)</div><div class=line>(:\d+)?</div><div class=line>(\/[^?#]*)?</div><div class=line>(\?[^#]*)?</div><div class=line>(#.*)?</div></pre></td></tr></table></figure><p>具体分析见下图：<br><img src=https://user-gold-cdn.xitu.io/2018/3/16/1622e2c97289603d?imageView2/0/w/1280/h/960/format/webp/ignore-error/1 alt=示意图><br>思考题：<br>正则表达式分割之千分符格式：<br><figure class="highlight js"><table><tr><td class=gutter><pre><div class=line>1</div></pre></td><td class=code><pre><div class=line><span class=number>213435324.099</span>.toString().replace(<span class=regexp>/\B(?=(\d&#123;3&#125;)+(?!\d))/g</span>, <span class=string>','</span>)</div></pre></td></tr></table></figure></p></div><div id=side-right-bar><div class=close-right-bar></div><div class=sidebar-toc><div class=sidebar-toc__title>目录</div><div class=sidebar-toc__progress><span class=progress-notice>你已经阅读了</span><span class=progress-num>0</span><span class=progress-percentage>%</span><div class=sidebar-toc__progress-bar></div></div><div class=sidebar-toc__content></div></div></div><div class=right-btn id=right-btn><span>目录</span></div><div class=article-bottom><div class="addthis_inline_share_toolbox fr"></div></div><div class=post-copyright><div class=post-copyright__author><span class=post-copyright-meta>文章作者:</span><span class=post-copyright-info><a href=mailto:undefined>CavinHuang</a></span></div><div class=post-copyright__type><span class=post-copyright-meta>文章链接:</span><span class=post-copyright-info><a href="http://blog.zukmb.cn正则表达式解析一个完整的url/">http://blog.zukmb.cn正则表达式解析一个完整的url/</a></span></div><div class=post-copyright__notice><span class=post-copyright-meta>版权声明:</span><span class=post-copyright-info>转载请注明来自<a href=http://blog.zukmb.cn target=_blank style="font-size: 18px;">CavinHuangのBlog</a>！</span></div></div><div class=article-pagenate><div class="article-prev fl"><span>←</span><a href="/H5手机端开发问题汇总及解决方案/">H5手机端开发问题汇总及解决方案</a></div><div class="article-next fr"><a href="/mysql密码修改，创建远程用户记录/">mysql密码修改，创建远程用户记录</a><span>→</span></div></div></article></div><footer class=footer><div id=toTop style="display: none;">Back to Top</div></footer></div></div><canvas class=fireworks></canvas><script src=/js/velocity.ui.min.js></script><script src=/js/yoyo.js></script><script src=/js/scroll.js></script><script src=/js/particle.js></script><script src=/js/anime.min.js></script><script src=/js/fireworks.js></script>