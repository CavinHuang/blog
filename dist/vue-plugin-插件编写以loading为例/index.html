<!DOCTYPE html><html lang=zh><head><meta charset=UTF-8><meta name=baidu-site-verification content=rqskM4bdtP><meta name=viewport content="device-width, initial-scale=1, maximum-scale=1,user-scalable=no"><title>vue plugin 插件编写以loading为例-CavinHuang-不懂写故事的猫-http://blog.zukmb.cn</title><meta name=keywords content=前端学习,php学习,个人博客,HTML,CSS,JS><meta name=description content=cavinHuang个人博客，这里记录学习和生活的点滴！><meta name=google-site-verification content=zOYxWUgmeogC0qY76WLP0eWl8r9E8jk_qU927Ij7tbs><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5a4c3745fa28006f"></script><link rel=stylesheet href=/css/yoyo.css><link rel=icon href=/img/favicon.png><link rel=stylesheet href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css?version=1.3"><script src=//cdn.bootcss.com/jquery/3.2.1/jquery.min.js></script><script src=//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js></script><script src=https://cdn.bootcss.com/velocity/1.5.0/velocity.min.js></script></head><body></body></html><div class=app><div class=left-container><canvas id=cas></canvas><div class="left-layout-container pc"><div class=user-info><a href="/"><img src="https://avatars1.githubusercontent.com/u/24950299?s=460&amp;v=4"></a><div class=login-name>CavinHuang</div><div class=slog>来不及总结自己,愿天大地大,我独一无二!</div></div><ul class=other-site><li><img src=http://www.17sucai.com/preview/177065/2017-09-28/Mon9/static/img/github.png></li><li><img src=http://www.17sucai.com/preview/177065/2017-09-28/Mon9/static/img/weibo.png></li></ul><ul class=left-menu><li><a href=/archives>文章</a></li><li><a href=/categories>分类</a></li><li><a href=/tags>标签</a></li><li><a href=/about>关于</a></li></ul><div class=qq-group><span>读万卷书</span><span>行万里路</span></div><div class=copyright>@ 2017 - 2017 CavinHuang</div></div></div><div class="blog-container main-container" id=content-outer><div class=blog-list-container id=content-inner><article class=article-container id=post><div class=article-header><h1 class=article-title>vue plugin 插件编写以loading为例</h1><div class=article-subtitle><div class="publish-time fl">发布时间:<span>2017/11/24 10:30:20</span></div><div class=categories>分类:<a href="/categories/前端开发/"><span>前端开发</span></a></div></div></div><div class=article-content><p>我们在使用vue开发的过程中，经常会遇到这两个问题：<br><a id=more></a></p><p>我要使用loading(加载动画) toast（浮层提示） dialog（弹框提示）之类的全局性组件，但是用全局组件注册的话非常麻烦，还要在template标签中书写组件html代码然后参数通过在data选项中注册变量来控制组件的显示/隐藏/提示语，显得异常麻烦~<br>我要使用某些全局函数例如（axios）来进行某些操作，如果每次使用都需要import或者require的话，是一件不太优雅的事情<br>所以我们就想到在vue的全局实例Vue或者指向这个实例的指针this的原型上添加某一方法来达到随用随取的效果。</p><p>本文以loading为例，讲下如何编写一个Vue插件。<br>首先我们编写一个普通的loading组件，作为插件的模板：<br><figure class="highlight javascript"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div><div class=line>4</div><div class=line>5</div><div class=line>6</div><div class=line>7</div><div class=line>8</div><div class=line>9</div><div class=line>10</div><div class=line>11</div><div class=line>12</div><div class=line>13</div><div class=line>14</div><div class=line>15</div><div class=line>16</div><div class=line>17</div><div class=line>18</div><div class=line>19</div><div class=line>20</div><div class=line>21</div><div class=line>22</div><div class=line>23</div><div class=line>24</div><div class=line>25</div><div class=line>26</div><div class=line>27</div><div class=line>28</div><div class=line>29</div><div class=line>30</div><div class=line>31</div><div class=line>32</div><div class=line>33</div><div class=line>34</div><div class=line>35</div><div class=line>36</div><div class=line>37</div><div class=line>38</div><div class=line>39</div><div class=line>40</div><div class=line>41</div><div class=line>42</div><div class=line>43</div><div class=line>44</div><div class=line>45</div><div class=line>46</div><div class=line>47</div><div class=line>48</div><div class=line>49</div><div class=line>50</div><div class=line>51</div><div class=line>52</div><div class=line>53</div><div class=line>54</div><div class=line>55</div><div class=line>56</div><div class=line>57</div><div class=line>58</div><div class=line>59</div><div class=line>60</div><div class=line>61</div><div class=line>62</div><div class=line>63</div><div class=line>64</div><div class=line>65</div><div class=line>66</div><div class=line>67</div><div class=line>68</div><div class=line>69</div><div class=line>70</div><div class=line>71</div><div class=line>72</div><div class=line>73</div><div class=line>74</div><div class=line>75</div><div class=line>76</div><div class=line>77</div><div class=line>78</div><div class=line>79</div><div class=line>80</div><div class=line>81</div><div class=line>82</div><div class=line>83</div><div class=line>84</div><div class=line>85</div><div class=line>86</div><div class=line>87</div><div class=line>88</div><div class=line>89</div><div class=line>90</div><div class=line>91</div><div class=line>92</div><div class=line>93</div><div class=line>94</div><div class=line>95</div><div class=line>96</div><div class=line>97</div><div class=line>98</div><div class=line>99</div><div class=line>100</div><div class=line>101</div><div class=line>102</div><div class=line>103</div><div class=line>104</div><div class=line>105</div><div class=line>106</div><div class=line>107</div><div class=line>108</div><div class=line>109</div><div class=line>110</div><div class=line>111</div><div class=line>112</div><div class=line>113</div><div class=line>114</div><div class=line>115</div><div class=line>116</div><div class=line>117</div><div class=line>118</div></pre></td><td class=code><pre><div class=line> <span class=comment>// my-project/src/plugin/loading/loading.vue</span></div><div class=line>&lt;template&gt;</div><div class=line>  &lt;transition :name=<span class=string>"animateName"</span>&gt;</div><div class=line>    &lt;div <span class=class><span class=keyword>class</span></span>=<span class=string>"loadings"</span> v-show=<span class=string>"isShow"</span>&gt;</div><div class=line>      &lt;div <span class=class><span class=keyword>class</span></span>=<span class=string>"loadings__loader"</span>&gt;</div><div class=line>        &lt;div <span class=class><span class=keyword>class</span></span>=<span class=string>"loadings__loader__dot"</span>&gt;<span class=xml><span class=tag>&lt;/<span class=name>div</span>&gt;</span></span></div><div class=line>        &lt;div <span class=class><span class=keyword>class</span></span>=<span class=string>"loadings__loader__dot"</span>&gt;<span class=xml><span class=tag>&lt;/<span class=name>div</span>&gt;</span></span></div><div class=line>        &lt;div <span class=class><span class=keyword>class</span></span>=<span class=string>"loadings__loader__dot"</span>&gt;<span class=xml><span class=tag>&lt;/<span class=name>div</span>&gt;</span></span></div><div class=line>        &lt;div <span class=class><span class=keyword>class</span></span>=<span class=string>"loadings__loader__dot"</span>&gt;<span class=xml><span class=tag>&lt;/<span class=name>div</span>&gt;</span></span></div><div class=line>        &lt;div <span class=class><span class=keyword>class</span></span>=<span class=string>"loadings__loader__dot"</span>&gt;<span class=xml><span class=tag>&lt;/<span class=name>div</span>&gt;</span></span></div><div class=line>      &lt;<span class=regexp>/div&gt;</span></div><div class=line><span class=regexp>    &lt;/</span>div&gt;</div><div class=line>  &lt;<span class=regexp>/transition&gt;</span></div><div class=line><span class=regexp>&lt;/</span>template&gt;</div><div class=line>&lt;script type=<span class=string>"text/babel"</span>&gt;</div><div class=line>  <span class=keyword>export</span> <span class=keyword>default</span> &#123;</div><div class=line>    data() &#123;</div><div class=line>      <span class=keyword>return</span> &#123;</div><div class=line>        isShow: <span class=literal>false</span>,</div><div class=line>        hasAnimate: <span class=literal>true</span>,</div><div class=line>      &#125;</div><div class=line>    &#125;,</div><div class=line>    computed: &#123;</div><div class=line>      <span class=comment>/**</span></div><div class=line><span class=comment>       * 动画效果样式，没有返回空</span></div><div class=line><span class=comment>       * @return &#123;String&#125; 样式</span></div><div class=line><span class=comment>       */</span></div><div class=line>      animateName() &#123;</div><div class=line>        <span class=keyword>return</span> <span class=keyword>this</span>.hasAnimate ? <span class=string>'opacity'</span> : <span class=string>''</span></div><div class=line>      &#125;,</div><div class=line>    &#125;,</div><div class=line>    methods: &#123;</div><div class=line>      <span class=comment>/**</span></div><div class=line><span class=comment>       * 开启动画效果</span></div><div class=line><span class=comment>       */</span></div><div class=line>      opemAnimate() &#123;</div><div class=line>        <span class=keyword>this</span>.hasAnimate = <span class=literal>true</span></div><div class=line>      &#125;,</div><div class=line>      <span class=comment>/**</span></div><div class=line><span class=comment>       * 去除动画效果</span></div><div class=line><span class=comment>       * @return &#123;Promise&#125; 返回promise</span></div><div class=line><span class=comment>       */</span></div><div class=line>      removeAnimate() &#123;</div><div class=line>        <span class=keyword>return</span> <span class=keyword>new</span> <span class=built_in>Promise</span>(<span class=function>(<span class=params>resolve</span>) =&gt;</span> &#123;</div><div class=line>          <span class=keyword>this</span>.hasAnimate = <span class=literal>false</span></div><div class=line>          resolve()</div><div class=line>        &#125;)</div><div class=line>      &#125;,</div><div class=line>      <span class=comment>/**</span></div><div class=line><span class=comment>       * 显示动画loading</span></div><div class=line><span class=comment>       */</span></div><div class=line>      show() &#123;</div><div class=line>        <span class=keyword>this</span>.isShow = <span class=literal>true</span></div><div class=line>      &#125;,</div><div class=line>      <span class=comment>/**</span></div><div class=line><span class=comment>       * 隐藏动画loading</span></div><div class=line><span class=comment>       */</span></div><div class=line>      hide() &#123;</div><div class=line>        <span class=keyword>this</span>.isShow = <span class=literal>false</span></div><div class=line>      &#125;,</div><div class=line>    &#125;,</div><div class=line>  &#125;</div><div class=line>&lt;<span class=regexp>/script&gt;</span></div><div class=line><span class=regexp></span></div><div class=line><span class=regexp>&lt;style lang="stylus" rel="stylesheet/</span>stylus<span class=string>" scope&gt;</span></div><div class=line><span class=string></span></div><div class=line><span class=string>  .loadings &#123;</span></div><div class=line><span class=string>    position: fixed;</span></div><div class=line><span class=string>    width: 100%;</span></div><div class=line><span class=string>    height: 100%;</span></div><div class=line><span class=string>    top: 0;</span></div><div class=line><span class=string>    left: 0;</span></div><div class=line><span class=string>    background: transparent;</span></div><div class=line><span class=string></span></div><div class=line><span class=string>    &amp;__loader &#123;</span></div><div class=line><span class=string>      position absolute</span></div><div class=line><span class=string>      top 50%</span></div><div class=line><span class=string>      left 50%</span></div><div class=line><span class=string>      transform translate3d(-50%,-50%,0)</span></div><div class=line><span class=string></span></div><div class=line><span class=string>      &amp;__dot &#123;</span></div><div class=line><span class=string>        width 40px</span></div><div class=line><span class=string>        height 40px</span></div><div class=line><span class=string>        background #3ac</span></div><div class=line><span class=string>        border-radius 100%</span></div><div class=line><span class=string>        display inline-block</span></div><div class=line><span class=string>        animation slide 1s infinite</span></div><div class=line><span class=string>        margin-right: 6px;</span></div><div class=line><span class=string></span></div><div class=line><span class=string>        for index in (1..5) &#123;</span></div><div class=line><span class=string>          &amp;:nth-child(&#123;index&#125;) &#123;</span></div><div class=line><span class=string>            animation-delay (0.2 + 0.1s * index)</span></div><div class=line><span class=string>            // background green(#ce2424, (50 * index))</span></div><div class=line><span class=string>            background lighten(#ce2424, (index * 6))</span></div><div class=line><span class=string>          &#125;</span></div><div class=line><span class=string>        &#125;</span></div><div class=line><span class=string>      &#125;</span></div><div class=line><span class=string>    &#125;</span></div><div class=line><span class=string>  &#125;</span></div><div class=line><span class=string></span></div><div class=line><span class=string>  @keyframes slide</span></div><div class=line><span class=string>    0%</span></div><div class=line><span class=string>      transform scale(1)</span></div><div class=line><span class=string>    50%</span></div><div class=line><span class=string>      opacity .3</span></div><div class=line><span class=string>      transform scale(2)</span></div><div class=line><span class=string>    100%</span></div><div class=line><span class=string>      transform scale(1)</span></div><div class=line><span class=string></span></div><div class=line><span class=string>  .opacity &#123;</span></div><div class=line><span class=string>    &amp;-enter-active, &amp;-leave-active &#123;</span></div><div class=line><span class=string>      transition: all 0.6s</span></div><div class=line><span class=string>    &#125;</span></div><div class=line><span class=string>    &amp;-enter, &amp;-leave-active &#123;</span></div><div class=line><span class=string>      opacity: 0</span></div><div class=line><span class=string>    &#125;</span></div><div class=line><span class=string>  &#125;</span></div><div class=line><span class=string>&lt;/style&gt;</span></div></pre></td></tr></table></figure></p><p>这时如果你将其注册为全局组件，也是可以使用的，但是前面我们说过，这样使用非常不优雅</p><p>然后我们将其做成插件<br><figure class="highlight javascript"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div><div class=line>4</div><div class=line>5</div><div class=line>6</div><div class=line>7</div><div class=line>8</div><div class=line>9</div><div class=line>10</div><div class=line>11</div><div class=line>12</div><div class=line>13</div><div class=line>14</div><div class=line>15</div><div class=line>16</div><div class=line>17</div><div class=line>18</div><div class=line>19</div><div class=line>20</div><div class=line>21</div><div class=line>22</div><div class=line>23</div><div class=line>24</div><div class=line>25</div><div class=line>26</div><div class=line>27</div><div class=line>28</div><div class=line>29</div><div class=line>30</div><div class=line>31</div><div class=line>32</div><div class=line>33</div><div class=line>34</div><div class=line>35</div><div class=line>36</div><div class=line>37</div><div class=line>38</div><div class=line>39</div><div class=line>40</div><div class=line>41</div><div class=line>42</div><div class=line>43</div><div class=line>44</div><div class=line>45</div><div class=line>46</div><div class=line>47</div><div class=line>48</div><div class=line>49</div><div class=line>50</div><div class=line>51</div><div class=line>52</div><div class=line>53</div><div class=line>54</div><div class=line>55</div></pre></td><td class=code><pre><div class=line> <span class=comment>// my-project/src/plugin/loading/index.js</span></div><div class=line><span class=keyword>import</span> Loading <span class=keyword>from</span> <span class=string>'./loading.vue'</span></div><div class=line></div><div class=line><span class=keyword>export</span> <span class=keyword>default</span> &#123;</div><div class=line>  <span class=comment>/**</span></div><div class=line><span class=comment>   * 每个插件都有的install方法，用于安装插件</span></div><div class=line><span class=comment>   * @param &#123;Object&#125; Vue - Vue类</span></div><div class=line><span class=comment>   * @param &#123;Object&#125; [pluginOptions] - 插件安装配置</span></div><div class=line><span class=comment>   */</span></div><div class=line>  install(Vue, pluginOptions = &#123;&#125;) &#123;</div><div class=line>    <span class=comment>// 创建"子类"方便挂载</span></div><div class=line>    <span class=keyword>const</span> VueLoading = Vue.extend(Loading)</div><div class=line>    <span class=keyword>let</span> loading = <span class=literal>null</span></div><div class=line></div><div class=line>    <span class=comment>/**</span></div><div class=line><span class=comment>     * 初始化并显示loading</span></div><div class=line><span class=comment>     * @returns &#123;Promise&#125; Promise实例</span></div><div class=line><span class=comment>     */</span></div><div class=line>    <span class=function><span class=keyword>function</span> <span class=title>$loading</span>(<span class=params></span>) </span>&#123;</div><div class=line>      <span class=keyword>return</span> <span class=keyword>new</span> <span class=built_in>Promise</span>(<span class=function>(<span class=params>resolve</span>) =&gt;</span> &#123;</div><div class=line>        <span class=comment>// 第一次调用</span></div><div class=line>        <span class=keyword>if</span> (!loading) &#123;</div><div class=line>          loading = <span class=keyword>new</span> VueLoading()</div><div class=line>          <span class=comment>// 手动创建一个未挂载的实例</span></div><div class=line>          loading.$mount()</div><div class=line>          <span class=comment>// 挂载</span></div><div class=line>          <span class=built_in>document</span>.querySelector(pluginOptions.container || <span class=string>'body'</span>).appendChild(loading.$el)</div><div class=line>        &#125;</div><div class=line>        <span class=comment>// 显示loading</span></div><div class=line>        loading.show()</div><div class=line>        resolve()</div><div class=line>      &#125;)</div><div class=line>    &#125;</div><div class=line>    <span class=comment>// 定义关闭loading方法</span></div><div class=line>    $loading.end = <span class=function>(<span class=params>noAnimate = <span class=literal>false</span></span>) =&gt;</span> &#123;</div><div class=line>      <span class=keyword>return</span> <span class=keyword>new</span> <span class=built_in>Promise</span>(<span class=function>(<span class=params>resolve</span>) =&gt;</span> &#123;</div><div class=line>        <span class=keyword>if</span> (!loading || !loading.isShow) &#123;</div><div class=line>          resolve()</div><div class=line>          <span class=keyword>return</span></div><div class=line>        &#125;</div><div class=line>        <span class=comment>// 首页判断是否在关闭时需要动画</span></div><div class=line>        <span class=keyword>if</span> (noAnimate) &#123;</div><div class=line>          <span class=comment>// 默认只在此次行为下移除动画,之后的行为仍有动画</span></div><div class=line>          loading.removeAnimate().then(<span class=function><span class=params>()</span> =&gt;</span> &#123;</div><div class=line>            loading.opemAnimate()</div><div class=line>          &#125;)</div><div class=line>        &#125;</div><div class=line></div><div class=line>        loading.hide()</div><div class=line>      &#125;)</div><div class=line>    &#125;</div><div class=line></div><div class=line>    Vue.loading = Vue.prototype.$loading = $loading</div><div class=line>  &#125;,</div><div class=line>&#125;</div></pre></td></tr></table></figure></p><p>然后我们在入口文件app.js中引入并且安装插件就可以了：<br><figure class="highlight javascript"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div><div class=line>4</div><div class=line>5</div><div class=line>6</div><div class=line>7</div><div class=line>8</div><div class=line>9</div><div class=line>10</div></pre></td><td class=code><pre><div class=line>···</div><div class=line><span class=keyword>import</span> Vue <span class=keyword>from</span> <span class=string>'vue'</span></div><div class=line><span class=keyword>import</span> VueLoading <span class=keyword>from</span> <span class=string>'./loading'</span></div><div class=line>···</div><div class=line></div><div class=line>···</div><div class=line>Vue.use(VueLoading, &#123;</div><div class=line>  container: <span class=string>'.app'</span>,</div><div class=line>&#125;)</div><div class=line>···</div></pre></td></tr></table></figure></p><p>接下来可以在你任意想要的地方执行this.loading()就可以启动loading动画了，在需要关闭的地方执行this.loading.end()就可以关闭咯</p></div><div id=side-right-bar><div class=close-right-bar></div><div class=sidebar-toc><div class=sidebar-toc__title>目录</div><div class=sidebar-toc__progress><span class=progress-notice>你已经阅读了</span><span class=progress-num>0</span><span class=progress-percentage>%</span><div class=sidebar-toc__progress-bar></div></div><div class=sidebar-toc__content></div></div></div><div class=right-btn id=right-btn><span>目录</span></div><div class=article-bottom><div class="addthis_inline_share_toolbox fr"></div></div><div class=post-copyright><div class=post-copyright__author><span class=post-copyright-meta>文章作者:</span><span class=post-copyright-info><a href=mailto:undefined>CavinHuang</a></span></div><div class=post-copyright__type><span class=post-copyright-meta>文章链接:</span><span class=post-copyright-info><a href="http://blog.zukmb.cnvue-plugin-插件编写以loading为例/">http://blog.zukmb.cnvue-plugin-插件编写以loading为例/</a></span></div><div class=post-copyright__notice><span class=post-copyright-meta>版权声明:</span><span class=post-copyright-info>转载请注明来自<a href=http://blog.zukmb.cn target=_blank style="font-size: 18px;">CavinHuangのBlog</a>！</span></div></div><div class=article-pagenate><div class="article-prev fl"><span>←</span><a href="/Linux创建用户只能访问某个目录/">Linux创建用户只能访问某个目录</a></div><div class="article-next fr"><a href="/Request-——-让-Node-js-http请求变得超简单/">Request —— 让 Node.js http请求变得超简单</a><span>→</span></div></div></article></div><footer class=footer><div id=toTop style="display: none;">Back to Top</div></footer></div></div><canvas class=fireworks></canvas><script src=/js/velocity.ui.min.js></script><script src=/js/yoyo.js></script><script src=/js/scroll.js></script><script src=/js/particle.js></script><script src=/js/anime.min.js></script><script src=/js/fireworks.js></script>