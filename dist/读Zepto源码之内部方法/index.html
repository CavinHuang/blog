<!DOCTYPE html><html lang=zh><head><meta charset=UTF-8><meta name=baidu-site-verification content=rqskM4bdtP><meta name=viewport content="device-width, initial-scale=1, maximum-scale=1,user-scalable=no"><title>读Zepto源码之内部方法-CavinHuang-不懂写故事的猫-http://blog.zukmb.cn</title><meta name=keywords content=前端学习,php学习,个人博客,HTML,CSS,JS><meta name=description content=cavinHuang个人博客，这里记录学习和生活的点滴！><meta name=google-site-verification content=zOYxWUgmeogC0qY76WLP0eWl8r9E8jk_qU927Ij7tbs><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5a4c3745fa28006f"></script><link rel=stylesheet href=/css/yoyo.css><link rel=icon href=/img/favicon.png><link rel=stylesheet href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css?version=1.3"><script src=//cdn.bootcss.com/jquery/3.2.1/jquery.min.js></script><script src=//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js></script><script src=https://cdn.bootcss.com/velocity/1.5.0/velocity.min.js></script></head><body></body></html><div class=app><div class=left-container><canvas id=cas></canvas><div class="left-layout-container pc"><div class=user-info><a href="/"><img src="https://avatars1.githubusercontent.com/u/24950299?s=460&amp;v=4"></a><div class=login-name>CavinHuang</div><div class=slog>来不及总结自己,愿天大地大,我独一无二!</div></div><ul class=other-site><li><img src=http://www.17sucai.com/preview/177065/2017-09-28/Mon9/static/img/github.png></li><li><img src=http://www.17sucai.com/preview/177065/2017-09-28/Mon9/static/img/weibo.png></li></ul><ul class=left-menu><li><a href=/archives>文章</a></li><li><a href=/categories>分类</a></li><li><a href=/tags>标签</a></li><li><a href=/about>关于</a></li></ul><div class=qq-group><span>读万卷书</span><span>行万里路</span></div><div class=copyright>@ 2017 - 2017 CavinHuang</div></div></div><div class="blog-container main-container" id=content-outer><div class=blog-list-container id=content-inner><article class=article-container id=post><div class=article-header><h1 class=article-title>读Zepto源码之内部方法</h1><div class=article-subtitle><div class="publish-time fl">发布时间:<span>2017/4/12 20:50:53</span></div><div class=categories>分类:</div></div></div><div class=article-content><h3 id=数组方法><a href=#数组方法 class=headerlink title=数组方法></a>数组方法</h3><p>定义<br><figure class="highlight javascript"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div><div class=line>4</div></pre></td><td class=code><pre><div class=line><span class=keyword>var</span> emptyArray = []</div><div class=line>    concat = emptyArray.concat</div><div class=line>    filter = emptyArray.filter</div><div class=line>    slice = emptyArray.slice</div></pre></td></tr></table></figure></p><a id=more></a><p>zepto 一开始就定义了一个空数组 emptyArray，定义这个空数组是为了取得数组的 concat、filter、slice 方法</p><p>compact<br><figure class="highlight javascript"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div><div class=line>4</div><div class=line>5</div></pre></td><td class=code><pre><div class=line><span class=function><span class=keyword>function</span> <span class=title>compact</span>(<span class=params>array</span>) </span>&#123;</div><div class=line>  <span class=keyword>return</span> filter.call(array, <span class=function><span class=keyword>function</span>(<span class=params>item</span>) </span>&#123;</div><div class=line>    <span class=keyword>return</span> item != <span class=literal>null</span></div><div class=line>  &#125;)</div><div class=line>&#125;</div></pre></td></tr></table></figure></p><p>删除数组中的 null 和 undefined</p><p>这里用的是数组的 filter 方法，过滤出 item != null 的元素，组成新的数组。这里删除掉 null 很容易理解，为什么还可以删除 undefined 呢？这是因为这里用了 != ，而不是用 !== ，用 != 时， null 各 undefined 都会先转换成 false 再进行比较。</p><p>关于 null 和 undefined 推荐看看这篇文章： undefined与null的区别</p><p>flatten<br><figure class="highlight javascript"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div></pre></td><td class=code><pre><div class=line><span class=function><span class=keyword>function</span> <span class=title>flatten</span>(<span class=params>array</span>) </span>&#123;</div><div class=line>  <span class=keyword>return</span> array.length &gt; <span class=number>0</span> ? $.fn.concat.apply([], array) : array</div><div class=line>&#125;</div></pre></td></tr></table></figure></p><p>将数组扁平化，例如将数组 [1,[2,3],[4,5],6,[7,[89]] 变成 [1,2,3,4,5,6,7,[8,9]] ,这个方法只能展开一层，多层嵌套也只能展开一层。</p><p>这里，我们先把 $.fn.concat 等价于数组的原生方法 concat，后面的章节也会分析 $.fn.concat 的。</p><p>这里比较巧妙的是利用了 apply ，apply 会将 array 中的 item 当成参数，concat.apply([], [1,2,3,[4,5]]) 相当于 [].concat(1,2,3,[4,5])，这样数组就扁平化了。</p><p>uniq<br><figure class="highlight javascript"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div><div class=line>4</div><div class=line>5</div></pre></td><td class=code><pre><div class=line>uniq = <span class=function><span class=keyword>function</span>(<span class=params>array</span>) </span>&#123;</div><div class=line>  <span class=keyword>return</span> filter.call(array, <span class=function><span class=keyword>function</span>(<span class=params>item, idx</span>) </span>&#123;</div><div class=line>    <span class=keyword>return</span> array.indexOf(item) == idx</div><div class=line>  &#125;)</div><div class=line>&#125;</div></pre></td></tr></table></figure></p><p>数组去重。</p><p>数组去重的原理是检测 item 在数组中第一次出现的位置是否和 item 所处的位置相等，如果不相等，则证明不是第一次出现，将其过滤掉。</p><p>字符串方法</p><p>camelize<br><figure class="highlight javascript"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div><div class=line>4</div><div class=line>5</div></pre></td><td class=code><pre><div class=line>camelize = <span class=function><span class=keyword>function</span>(<span class=params>str</span>) </span>&#123;</div><div class=line>  <span class=keyword>return</span> str.replace(<span class=regexp>/-+(.)?/g</span>, <span class=function><span class=keyword>function</span>(<span class=params>match, chr</span>) </span>&#123;</div><div class=line>    <span class=keyword>return</span> chr ? chr.toUpperCase() : <span class=string>''</span></div><div class=line>  &#125;)</div><div class=line>&#125;</div></pre></td></tr></table></figure></p><p>将 word-word 的形式的字符串转换成 wordWord 的形式， - 可以为一个或多个。</p><p>正则表达式匹配了一个或多个 - ，捕获组是捕获 - 号后的第一个字母，并将字母变成大写。</p><p>dasherize<br><figure class="highlight javascript"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div><div class=line>4</div><div class=line>5</div><div class=line>6</div><div class=line>7</div></pre></td><td class=code><pre><div class=line><span class=function><span class=keyword>function</span> <span class=title>dasherize</span>(<span class=params>str</span>) </span>&#123;</div><div class=line>    <span class=keyword>return</span> str.replace(<span class=regexp>/::/g</span>, <span class=string>'/'</span>)</div><div class=line>           .replace(<span class=regexp>/([A-Z]+)([A-Z][a-z])/g</span>, <span class=string>'$1_$2'</span>)</div><div class=line>           .replace(<span class=regexp>/([a-z\d])([A-Z])/g</span>, <span class=string>'$1_$2'</span>)</div><div class=line>           .replace(<span class=regexp>/_/g</span>, <span class=string>'-'</span>)</div><div class=line>           .toLowerCase()</div><div class=line>  &#125;</div></pre></td></tr></table></figure></p><p>将驼峰式的写法转换成连字符 - 的写法。</p><p>例如 a = A6DExample::Before</p><p>第一个正则表达式是将字符串中的 :: 替换成 / 。a 变成 A6DExample/Before</p><p>第二个正则是在出现一次或多次大写字母和出现一次大写字母和连续一次或多次小写字母之间加入 _。a 变成 A6D_Example/Before</p><p>第三个正则是将出现一次小写字母或数字和出现一次大写字母之间加上 _。a 变成A6_D_Example/Before</p><p>第四个正则表达式是将 _ 替换成 -。a 变成A6-D-Example/Before</p><p>最后是将所有的大写字母转换成小写字母。a 变成 a6-d-example/before</p><p>我对正则不太熟悉，正则解释部分参考自:zepto源码–compact、flatten、camelize、dasherize、uniq–学习笔记</p><p>数据类型检测</p><p>定义<br><figure class="highlight javascript"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div><div class=line>4</div><div class=line>5</div><div class=line>6</div><div class=line>7</div></pre></td><td class=code><pre><div class=line>class2type = &#123;&#125;,</div><div class=line>toString = class2type.toString,</div><div class=line></div><div class=line>  <span class=comment>// Populate the class2type map</span></div><div class=line>$.each(<span class=string>"Boolean Number String Function Array Date RegExp Object Error"</span>.split(<span class=string>" "</span>), <span class=function><span class=keyword>function</span>(<span class=params>i, name</span>) </span>&#123;</div><div class=line>  class2type[<span class=string>"[object "</span> + name + <span class=string>"]"</span>] = name.toLowerCase()</div><div class=line>&#125;)</div></pre></td></tr></table></figure></p><p>$.each 函数后面的文章会讲到，这段代码是将基本类型挂到 class2type 对象上。class2type 将会是如下的形式：<br><figure class="highlight javascript"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div><div class=line>4</div><div class=line>5</div></pre></td><td class=code><pre><div class=line>class2type = &#123;</div><div class=line>  <span class=string>"[object Boolean]"</span>: <span class=string>"boolean"</span>,</div><div class=line>  <span class=string>"[object Number]"</span>: <span class=string>"number"</span></div><div class=line>  ...</div><div class=line>&#125;</div></pre></td></tr></table></figure></p><p>type<br><figure class="highlight javascript"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div><div class=line>4</div></pre></td><td class=code><pre><div class=line><span class=function><span class=keyword>function</span> <span class=title>type</span>(<span class=params>obj</span>) </span>&#123;</div><div class=line>  <span class=keyword>return</span> obj == <span class=literal>null</span> ? <span class=built_in>String</span>(obj) :</div><div class=line>  class2type[toString.call(obj)] || <span class=string>"object"</span></div><div class=line>&#125;</div></pre></td></tr></table></figure></p><p>type 函数返回的是数据的类型。</p><p>如果 obj == null ，也就是 null 和 undefined，返回的是字符串 null 或 undefined</p><p>否则调用 Object.prototype.toString （toString = class2type.toString）方法，将返回的结果作为 class2type 的 key 取值。Object.prototype.toString 对不同的数据类型会返回形如 [object Boolean] 的结果。</p><p>如果都不是以上情况，默认返回 object 类型。</p><p>isFunction &amp; isObject<br><figure class="highlight javascript"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div><div class=line>4</div><div class=line>5</div><div class=line>6</div></pre></td><td class=code><pre><div class=line><span class=function><span class=keyword>function</span> <span class=title>isFunction</span>(<span class=params>value</span>) </span>&#123;</div><div class=line>  <span class=keyword>return</span> type(value) === <span class=string>'function'</span></div><div class=line>&#125;</div><div class=line><span class=function><span class=keyword>function</span> <span class=title>isObject</span>(<span class=params>obj</span>) </span>&#123;</div><div class=line>  <span class=keyword>return</span> type(obj) == <span class=string>'object'</span></div><div class=line>&#125;</div></pre></td></tr></table></figure></p><p>调用 type 函数，判断返回的类型字符串，就知道是什么数据类型了</p><p>isWindow<br><figure class="highlight javascript"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div></pre></td><td class=code><pre><div class=line><span class=function><span class=keyword>function</span> <span class=title>isWindow</span>(<span class=params>obj</span>) </span>&#123;</div><div class=line>  <span class=keyword>return</span> obj != <span class=literal>null</span> &amp;&amp; obj == obj.window</div><div class=line>&#125;</div></pre></td></tr></table></figure></p><p>判断是否为浏览器的 window 对象</p><p>要为 window 对象首先要满足的条件是不能为 null 或者 undefined， 并且 obj.window 为自身的引用。</p><p>isDocument<br><figure class="highlight javascript"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div></pre></td><td class=code><pre><div class=line><span class=function><span class=keyword>function</span> <span class=title>isDocument</span>(<span class=params>obj</span>) </span>&#123;</div><div class=line>  <span class=keyword>return</span> obj != <span class=literal>null</span> &amp;&amp; obj.nodeType == obj.DOCUMENT_NODE</div><div class=line>&#125;</div></pre></td></tr></table></figure></p><p>判断是否为 document 对象</p><p>节点上有 nodeType 属性，每个属性值都有对应的常量。document 的 nodeType 值为 9 ，常量为 DOCUMENT_NODE。</p><p>具体见：MDN文档：Node.nodeType</p><p>isPlainObject<br><figure class="highlight javascript"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div></pre></td><td class=code><pre><div class=line><span class=function><span class=keyword>function</span> <span class=title>isPlainObject</span>(<span class=params>obj</span>) </span>&#123;</div><div class=line>  <span class=keyword>return</span> isObject(obj) &amp;&amp; !isWindow(obj) &amp;&amp; <span class=built_in>Object</span>.getPrototypeof(obj) == <span class=built_in>Object</span>.prototype</div><div class=line>&#125;</div></pre></td></tr></table></figure></p><p>判断是否为纯粹的对象</p><p>纯粹对象首先必须是对象 isObject(obj)</p><p>并且不是 window 对象 !isWindow(obj)</p><p>并且原型要和 Object 的原型相等</p><p>isArray<br><figure class="highlight javascript"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div></pre></td><td class=code><pre><div class=line>isArray = <span class=built_in>Array</span>.isArray ||</div><div class=line>           <span class=function><span class=keyword>function</span>(<span class=params>object</span>) </span>&#123; <span class=keyword>return</span> object <span class=keyword>instanceof</span> <span class=built_in>Array</span>&#125;</div></pre></td></tr></table></figure></p><p>这个方法来用判断是否为数组类型。</p><p>如果浏览器支持数组的 isArray 原生方法，就采用原生方法，否则检测数据是否为 Array 的实例。</p><p>我们都知道，instanceof 的检测的原理是查找实例的 prototype 是否在构造函数的原型链上，如果在，则返回 true。 所以用 instanceof 可能会得到不太准确的结果。例如：</p><p>index.html<br><figure class="highlight html"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div><div class=line>4</div><div class=line>5</div><div class=line>6</div><div class=line>7</div><div class=line>8</div><div class=line>9</div><div class=line>10</div><div class=line>11</div><div class=line>12</div><div class=line>13</div><div class=line>14</div><div class=line>15</div><div class=line>16</div><div class=line>17</div><div class=line>18</div><div class=line>19</div></pre></td><td class=code><pre><div class=line><span class=meta>&lt;!DOCTYPE html&gt;</span></div><div class=line><span class=tag>&lt;<span class=name>html</span> <span class=attr>lang</span>=<span class=string>"en"</span>&gt;</span></div><div class=line><span class=tag>&lt;<span class=name>head</span>&gt;</span></div><div class=line>    <span class=tag>&lt;<span class=name>meta</span> <span class=attr>charset</span>=<span class=string>"UTF-8"</span>&gt;</span></div><div class=line>    <span class=tag>&lt;<span class=name>script</span>&gt;</span><span class=undefined></span></div><div class=line><span class=javascript>        <span class=built_in>window</span>.onload = <span class=function><span class=keyword>function</span> (<span class=params></span>) </span>&#123;</span></div><div class=line><span class=javascript>            <span class=keyword>var</span> fwindow = <span class=built_in>window</span>.framePage.contentWindow <span class=comment>// frame 页面的window对象</span></span></div><div class=line><span class=actionscript>            <span class=keyword>var</span> fArray = fwindow.Array  <span class=comment>// frame 页面的Array</span></span></div><div class=line><span class=actionscript>            <span class=keyword>var</span> fdata = fwindow.data  <span class=comment>// frame 页面的 data [1,2,3]</span></span></div><div class=line><span class=javascript>            <span class=built_in>console</span>.log(fdata <span class=keyword>instanceof</span> fArray) <span class=comment>// true</span></span></div><div class=line><span class=javascript>            <span class=built_in>console</span>.log(fdata <span class=keyword>instanceof</span> <span class=built_in>Array</span>) <span class=comment>// false</span></span></div><div class=line><span class=undefined>        &#125;</span></div><div class=line><span class=undefined>    </span><span class=tag>&lt;/<span class=name>script</span>&gt;</span></div><div class=line>    <span class=tag>&lt;<span class=name>title</span>&gt;</span>Document<span class=tag>&lt;/<span class=name>title</span>&gt;</span></div><div class=line><span class=tag>&lt;/<span class=name>head</span>&gt;</span></div><div class=line><span class=tag>&lt;<span class=name>body</span>&gt;</span></div><div class=line>    <span class=tag>&lt;<span class=name>iframe</span> <span class=attr>id</span>=<span class=string>"framePage"</span> <span class=attr>src</span>=<span class=string>"frame.html"</span> <span class=attr>frameborder</span>=<span class=string>"0"</span>&gt;</span><span class=tag>&lt;/<span class=name>iframe</span>&gt;</span></div><div class=line><span class=tag>&lt;/<span class=name>body</span>&gt;</span></div><div class=line><span class=tag>&lt;/<span class=name>html</span>&gt;</span></div></pre></td></tr></table></figure></p><p>frame.html<br><figure class="highlight html"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div><div class=line>4</div><div class=line>5</div><div class=line>6</div><div class=line>7</div><div class=line>8</div><div class=line>9</div><div class=line>10</div><div class=line>11</div><div class=line>12</div><div class=line>13</div></pre></td><td class=code><pre><div class=line><span class=meta>&lt;!DOCTYPE html&gt;</span></div><div class=line><span class=tag>&lt;<span class=name>html</span> <span class=attr>lang</span>=<span class=string>"en"</span>&gt;</span></div><div class=line><span class=tag>&lt;<span class=name>head</span>&gt;</span></div><div class=line>    <span class=tag>&lt;<span class=name>meta</span> <span class=attr>charset</span>=<span class=string>"UTF-8"</span>&gt;</span></div><div class=line>    <span class=tag>&lt;<span class=name>title</span>&gt;</span>Document<span class=tag>&lt;/<span class=name>title</span>&gt;</span></div><div class=line>    <span class=tag>&lt;<span class=name>script</span>&gt;</span><span class=undefined></span></div><div class=line><span class=javascript>        <span class=built_in>window</span>.data = [<span class=number>1</span>,<span class=number>2</span>,<span class=number>3</span>]</span></div><div class=line><span class=undefined>    </span><span class=tag>&lt;/<span class=name>script</span>&gt;</span></div><div class=line><span class=tag>&lt;/<span class=name>head</span>&gt;</span></div><div class=line><span class=tag>&lt;<span class=name>body</span>&gt;</span></div><div class=line>    <span class=tag>&lt;<span class=name>p</span>&gt;</span>frame page<span class=tag>&lt;/<span class=name>p</span>&gt;</span></div><div class=line><span class=tag>&lt;/<span class=name>body</span>&gt;</span></div><div class=line><span class=tag>&lt;/<span class=name>html</span>&gt;</span></div></pre></td></tr></table></figure></p><p>由于 iframe 是在独立的环境中运行的，所以 fdata instanceof Array 返回的 false 。</p><p>在 MDN 上看到，可以用这样的 ployfill 来使用 isArray<br><figure class="highlight javascript"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div><div class=line>4</div><div class=line>5</div></pre></td><td class=code><pre><div class=line><span class=keyword>if</span> (!<span class=built_in>Array</span>.isArray) &#123;</div><div class=line>  <span class=built_in>Array</span>.isArray = <span class=function><span class=keyword>function</span>(<span class=params>arg</span>) </span>&#123;</div><div class=line>    <span class=keyword>return</span> <span class=built_in>Object</span>.prototype.toString.call(arg) === <span class=string>'[object Array]'</span></div><div class=line>  &#125;</div><div class=line>&#125;</div></pre></td></tr></table></figure></p><p>也就是说，isArray 可以修改成这样：<br><figure class="highlight javascript"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div></pre></td><td class=code><pre><div class=line>isArray = <span class=built_in>Array</span>.isArray ||</div><div class=line>           <span class=function><span class=keyword>function</span>(<span class=params>object</span>) </span>&#123; <span class=keyword>return</span> <span class=built_in>Object</span>.prototype.toString.call(object) === <span class=string>'[object Array]'</span>&#125;</div></pre></td></tr></table></figure></p><p>为什么 zepto 不这样写呢？知道的可以留言告知下。</p><p>likeArray<br><figure class="highlight javascript"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div><div class=line>4</div><div class=line>5</div><div class=line>6</div><div class=line>7</div><div class=line>8</div><div class=line>9</div><div class=line>10</div><div class=line>11</div><div class=line>12</div><div class=line>13</div></pre></td><td class=code><pre><div class=line><span class=function><span class=keyword>function</span> <span class=title>likeArray</span>(<span class=params>obj</span>) </span>&#123;</div><div class=line>  <span class=keyword>var</span> length = !!obj &amp;&amp;   <span class=comment>// obj必须存在</span></div><div class=line>                  <span class=string>'length'</span> <span class=keyword>in</span> obj &amp;&amp; <span class=comment>// obj 中必须存在 length 属性</span></div><div class=line>                  obj.length, <span class=comment>// 返回 length的值</span></div><div class=line>      type = $.type(obj) <span class=comment>// 调用 type 函数，返回 obj 的数据类型。这里我有点不太明白，为什么要覆盖掉上面定义的 type 函数呢？再定义多一个变量，直接调用 type 函数不好吗？</span></div><div class=line></div><div class=line>  <span class=keyword>return</span> <span class=string>'function'</span> != type &amp;&amp;  <span class=comment>// 不为function类型</span></div><div class=line>        !isWindow(obj) &amp;&amp;  <span class=comment>// 并且不为window类型</span></div><div class=line>        (</div><div class=line>            <span class=string>'array'</span> == type || length === <span class=number>0</span> || <span class=comment>// 如果为 array 类型或者length 的值为 0，返回true</span></div><div class=line>    (<span class=keyword>typeof</span> length == <span class=string>'number'</span> &amp;&amp; length &gt; <span class=number>0</span> &amp;&amp; (length - <span class=number>1</span>) <span class=keyword>in</span> obj)  <span class=comment>// 或者 length 为数字，并且 length的值大于零，并且 length - 1 为 obj 的 key</span></div><div class=line>  )</div><div class=line>&#125;</div></pre></td></tr></table></figure></p><p>判断是否为数据是否为类数组。</p><p>类数组的形式如下：<br><figure class="highlight javascript"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div><div class=line>4</div><div class=line>5</div><div class=line>6</div></pre></td><td class=code><pre><div class=line>likeArrayData = &#123;</div><div class=line>  <span class=string>'0'</span>: <span class=number>0</span>,</div><div class=line>  <span class=string>'1'</span>: <span class=number>1</span>,</div><div class=line>  <span class=string>"2"</span>: <span class=number>2</span></div><div class=line>  length: <span class=number>3</span></div><div class=line>&#125;</div></pre></td></tr></table></figure></p><p>可以看到，类数组都有 length 属性，并且 key 为按0,1,2,3 顺序的数字。</p><p>代码已经有注释了，这里再简单总结下</p><p>首先将 function类型和 window 对象排除</p><p>再将 type 为 array 和 length === 0 的认为是类数组。type 为 array 比较容易理解，length === 0 其实就是将其看作为空数组。</p><p>最后一种情况必须要满足三个条件：</p><p>length 必须为数字<br>length 必须大于 0 ，表示有元素存在于类数组中<br>key length - 1 必须存在于 obj 中。我们都知道，数组最后的 index 值为 length -1 ，这里也是检查最后一个 key 是否存在。</p></div><div id=side-right-bar><div class=close-right-bar></div><div class=sidebar-toc><div class=sidebar-toc__title>目录</div><div class=sidebar-toc__progress><span class=progress-notice>你已经阅读了</span><span class=progress-num>0</span><span class=progress-percentage>%</span><div class=sidebar-toc__progress-bar></div></div><div class=sidebar-toc__content><ol class=toc><li class="toc-item toc-level-3"><a class=toc-link href=#数组方法><span class=toc-number>1.</span> <span class=toc-text>数组方法</span></a></li></ol></div></div></div><div class=right-btn id=right-btn><span>目录</span></div><div class=article-bottom><div class="addthis_inline_share_toolbox fr"></div></div><div class=post-copyright><div class=post-copyright__author><span class=post-copyright-meta>文章作者:</span><span class=post-copyright-info><a href=mailto:undefined>CavinHuang</a></span></div><div class=post-copyright__type><span class=post-copyright-meta>文章链接:</span><span class=post-copyright-info><a href="http://blog.zukmb.cn读Zepto源码之内部方法/">http://blog.zukmb.cn读Zepto源码之内部方法/</a></span></div><div class=post-copyright__notice><span class=post-copyright-meta>版权声明:</span><span class=post-copyright-info>转载请注明来自<a href=http://blog.zukmb.cn target=_blank style="font-size: 18px;">CavinHuangのBlog</a>！</span></div></div><div class=article-pagenate><div class="article-prev fl"><span>←</span><a href="/vue-js学习系列-IMWeb训练营作业-完成Todolist小demo/">vue-js学习系列-IMWeb训练营作业-完成Todolist小demo</a></div><div class="article-next fr"><a href="/百度前端学院js系列-第二天详解/">百度前端学院js系列-第二天详解</a><span>→</span></div></div></article></div><footer class=footer><div id=toTop style="display: none;">Back to Top</div></footer></div></div><canvas class=fireworks></canvas><script src=/js/velocity.ui.min.js></script><script src=/js/yoyo.js></script><script src=/js/scroll.js></script><script src=/js/particle.js></script><script src=/js/anime.min.js></script><script src=/js/fireworks.js></script>