<!DOCTYPE html><html lang=zh><head><meta charset=UTF-8><meta name=baidu-site-verification content=rqskM4bdtP><meta name=viewport content="device-width, initial-scale=1, maximum-scale=1,user-scalable=no"><title>centos7 源码编译安装mysql5.7-CavinHuang-不懂写故事的猫-http://blog.zukmb.cn</title><meta name=keywords content=前端学习,php学习,个人博客,HTML,CSS,JS><meta name=description content=cavinHuang个人博客，这里记录学习和生活的点滴！><meta name=google-site-verification content=zOYxWUgmeogC0qY76WLP0eWl8r9E8jk_qU927Ij7tbs><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5a4c3745fa28006f"></script><link rel=stylesheet href=/css/yoyo.css><link rel=icon href=/img/favicon.png><link rel=stylesheet href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css?version=1.3"><script src=//cdn.bootcss.com/jquery/3.2.1/jquery.min.js></script><script src=//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js></script><script src=https://cdn.bootcss.com/velocity/1.5.0/velocity.min.js></script></head><body></body></html><div class=app><div class=left-container><canvas id=cas></canvas><div class="left-layout-container pc"><div class=user-info><a href="/"><img src="https://avatars1.githubusercontent.com/u/24950299?s=460&amp;v=4"></a><div class=login-name>CavinHuang</div><div class=slog>来不及总结自己,愿天大地大,我独一无二!</div></div><ul class=other-site><li><img src=http://www.17sucai.com/preview/177065/2017-09-28/Mon9/static/img/github.png></li><li><img src=http://www.17sucai.com/preview/177065/2017-09-28/Mon9/static/img/weibo.png></li></ul><ul class=left-menu><li><a href=/archives>文章</a></li><li><a href=/categories>分类</a></li><li><a href=/tags>标签</a></li><li><a href=/about>关于</a></li></ul><div class=qq-group><span>读万卷书</span><span>行万里路</span></div><div class=copyright>@ 2017 - 2017 CavinHuang</div></div></div><div class="blog-container main-container" id=content-outer><div class=blog-list-container id=content-inner><article class=article-container id=post><div class=article-header><h1 class=article-title>centos7 源码编译安装mysql5.7</h1><div class=article-subtitle><div class="publish-time fl">发布时间:<span>2018/5/5 13:58:3</span></div><div class=categories>分类:<a href="/categories/服务器纪实/"><span>服务器纪实</span></a>/<a href="/categories/服务器纪实/mysql/"><span>mysql</span></a></div></div></div><div class=article-content><h2 id=1-准备工作><a href=#1-准备工作 class=headerlink title=1.准备工作></a>1.准备工作</h2><p>首先需要准备mysql的源码包，最新版本是5.7.12<br>下载地址为：<br><a href=http://cdn.mysql.com//Downloads/MySQL-5.7/mysql-5.7.12.tar.gz target=_blank rel=external>http://cdn.mysql.com//Downloads/MySQL-5.7/mysql-5.7.12.tar.gz</a><br><a id=more></a><br>同时，mysql 5.7需要boost 1.59以及以上版本，需要在sourceforge上下载。地址为：<br><a href="http://www.boost.org/users/download/" target=_blank rel=external>http://www.boost.org/users/download/</a></p><p>安装之前最好检查一下是否已安装了mysql和boost<br><figure class="highlight bash"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div><div class=line>4</div><div class=line>5</div><div class=line>6</div></pre></td><td class=code><pre><div class=line>rpm -qa | grep mysql    <span class=comment>#查看系统自带mysql</span></div><div class=line>yum -y remove mysql-*   <span class=comment>#卸载mysql</span></div><div class=line>rpm -e --nodeps mysql-5.1.73-3.el6_5.x86_64 <span class=comment>#卸载mysql</span></div><div class=line>rpm -qa | grep boost    <span class=comment>#查看系统自带boost</span></div><div class=line>yum -y remove boost-*   <span class=comment>#卸载boost</span></div><div class=line>rpm -e --nodeps boost-filesystem-1.41.0-11.el6_1.2.x86_64 <span class=comment>#卸载boost</span></div></pre></td></tr></table></figure></p><p>然后安装其它得依赖包：<br><figure class="highlight bash"><table><tr><td class=gutter><pre><div class=line>1</div></pre></td><td class=code><pre><div class=line>yum install gcc gcc-c++ ncurses ncurses-devel bison libgcrypt perl cmake</div></pre></td></tr></table></figure></p><h2 id=2-准备安装><a href=#2-准备安装 class=headerlink title=2.准备安装></a>2.准备安装</h2><p>首先将boost库解压出来<br><figure class="highlight bash"><table><tr><td class=gutter><pre><div class=line>1</div></pre></td><td class=code><pre><div class=line>tar -zxvf boost_1_59_0.tar.gz</div></pre></td></tr></table></figure></p><p>然后拷贝到一个目录中<br><figure class="highlight bash"><table><tr><td class=gutter><pre><div class=line>1</div></pre></td><td class=code><pre><div class=line>mv boost_1_59_0 /usr/<span class=built_in>local</span>/boost</div></pre></td></tr></table></figure></p><p>然后创建用户组以及用户<br><figure class="highlight bash"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div><div class=line>4</div></pre></td><td class=code><pre><div class=line>cat /etc/group | grep mysql     <span class=comment>#查看是否存在mysql用户组</span></div><div class=line>cat /etc/passwd | grep mysql    <span class=comment>#查看是否存在mysql用户</span></div><div class=line>groupadd mysql                  <span class=comment>#创建用户组</span></div><div class=line>useradd -r -g mysql mysql       <span class=comment>#创建用户</span></div></pre></td></tr></table></figure></p><p>上面得工作完成以后，就可以开始编译mysql了，当然，先将mysql的源码解压出来：<br><figure class="highlight bash"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div></pre></td><td class=code><pre><div class=line>tar xzvf mysql-5.7.12.tar.gz</div><div class=line><span class=built_in>cd</span> mysql-5.7.12</div></pre></td></tr></table></figure></p><p>使用cmake和make命令来进行编译<br><figure class="highlight bash"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div></pre></td><td class=code><pre><div class=line>cmake . -DCMAKE_INSTALL_PREFIX=/usr/<span class=built_in>local</span>/mysql -DMYSQL_DATADIR=/usr/<span class=built_in>local</span>/mysql/data -DDEFAULT_CHARSET=utf8 -DDEFAULT_COLLATION=utf8_general_ci -DMYSQL_TCP_PORT=3306 -DMYSQL_USER=mysql -DWITH_MYISAM_STORAGE_ENGINE=1 -DWITH_INNOBASE_STORAGE_ENGINE=1 -DWITH_ARCHIVE_STORAGE_ENGINE=1 -DWITH_BLACKHOLE_STORAGE_ENGINE=1 -DWITH_MEMORY_STORAGE_ENGINE=1 -DENABLE_DOWNLOADS=1 -DDOWNLOAD_BOOST=1 -DWITH_BOOST=/usr/<span class=built_in>local</span>/boost</div><div class=line></div><div class=line>make</div></pre></td></tr></table></figure></p><p>编译会消耗较多的时间，期间可以喝杯茶，或者来创建几个目录，因为我们指定编译参数得时候，指定了mysql得数据存储的目录，因此，这个时候可以先把目录都创建出来：</p><figure class="highlight bash"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div><div class=line>4</div></pre></td><td class=code><pre><div class=line>mkdir /usr/<span class=built_in>local</span>/mysql</div><div class=line>mkdir /usr/<span class=built_in>local</span>/mysql/data</div><div class=line>mkdir /usr/<span class=built_in>local</span>/mysql/logs</div><div class=line>mkdir /usr/<span class=built_in>local</span>/mysql/pids</div></pre></td></tr></table></figure><p>最后还有重要得一步，需要将目录得所有权交给mysql用户<br><figure class="highlight bash"><table><tr><td class=gutter><pre><div class=line>1</div></pre></td><td class=code><pre><div class=line>chown -R mysql:mysql /usr/<span class=built_in>local</span>/mysql  <span class=comment>#需要root权限</span></div></pre></td></tr></table></figure></p><p>编译完成后执行make install 安装即可<br>随后，我们需要配置/etc/my.cnf文件：<br><figure class="highlight bash"><table><tr><td class=gutter><pre><div class=line>1</div></pre></td><td class=code><pre><div class=line>vim /etc/my.cnf</div></pre></td></tr></table></figure></p><p>然后写入参数，最终如下；<br><figure class="highlight bash"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div><div class=line>4</div><div class=line>5</div><div class=line>6</div><div class=line>7</div><div class=line>8</div><div class=line>9</div><div class=line>10</div><div class=line>11</div><div class=line>12</div><div class=line>13</div><div class=line>14</div><div class=line>15</div><div class=line>16</div><div class=line>17</div><div class=line>18</div><div class=line>19</div><div class=line>20</div><div class=line>21</div><div class=line>22</div><div class=line>23</div><div class=line>24</div><div class=line>25</div><div class=line>26</div><div class=line>27</div></pre></td><td class=code><pre><div class=line><span class=comment># For advice on how to change settings please see</span></div><div class=line><span class=comment># http://dev.mysql.com/doc/refman/5.7/en/server-configuration-defaults.html</span></div><div class=line></div><div class=line>[mysqld]</div><div class=line><span class=comment>#</span></div><div class=line><span class=comment># Remove leading # and set to the amount of RAM for the most important data</span></div><div class=line><span class=comment># cache in MySQL. Start at 70% of total RAM for dedicated server, else 10%.</span></div><div class=line><span class=comment># innodb_buffer_pool_size = 128M</span></div><div class=line><span class=comment>#</span></div><div class=line><span class=comment># Remove leading # to turn on a very important data integrity option: logging</span></div><div class=line><span class=comment># changes to the binary log between backups.</span></div><div class=line><span class=comment># log_bin</span></div><div class=line><span class=comment>#</span></div><div class=line><span class=comment># Remove leading # to set options mainly useful for reporting servers.</span></div><div class=line><span class=comment># The server defaults are faster for transactions and fast SELECTs.</span></div><div class=line><span class=comment># Adjust sizes as needed, experiment to find the optimal values.</span></div><div class=line><span class=comment># join_buffer_size = 128M</span></div><div class=line><span class=comment># sort_buffer_size = 2M</span></div><div class=line><span class=comment># read_rnd_buffer_size = 2M</span></div><div class=line>datadir=/usr/<span class=built_in>local</span>/mysql/data</div><div class=line>socket=/usr/<span class=built_in>local</span>/mysql/mysql.sock</div><div class=line></div><div class=line><span class=comment># Disabling symbolic-links is recommended to prevent assorted security risks</span></div><div class=line>symbolic-links=0</div><div class=line></div><div class=line><span class=built_in>log</span>-error=/usr/<span class=built_in>local</span>/mysql/logs/mysqld.log</div><div class=line>pid-file=/usr/<span class=built_in>local</span>/mysql/pids/mysqld.pid</div></pre></td></tr></table></figure></p><h2 id=3-性能调优><a href=#3-性能调优 class=headerlink title=3.性能调优></a>3.性能调优</h2><p>由于编译的时间是在太长了，这个地方的性能调优不涉及任何的sql优化，只针对一点：使用jemalloc来替换默认的内存管理<br>首先我们需要从网站上下载jemalloc，官网地址：<br><a href="http://www.canonware.com/jemalloc/" target=_blank rel=external>http://www.canonware.com/jemalloc/</a></p><p>从github上可以下载最新的源码：<br><a href=https://github.com/jemalloc/jemalloc/releases target=_blank rel=external>https://github.com/jemalloc/jemalloc/releases</a></p><p>编译jemalloc：<br><figure class="highlight bash"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div></pre></td><td class=code><pre><div class=line>./configure --libdir=/usr/<span class=built_in>local</span>/lib</div><div class=line>make</div><div class=line>make install</div></pre></td></tr></table></figure></p><p>为了保证能够找到jemalloc库，我们需要设置一下库路径，<br><figure class="highlight bash"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div></pre></td><td class=code><pre><div class=line><span class=built_in>echo</span> <span class=string>"/usr/local/lib"</span> &gt; /etc/ld.so.conf.d/usr_local_lib.conf</div><div class=line>ldconfig //执行这个命令可以刷新库路径</div></pre></td></tr></table></figure></p><p>我们有两种方式来使用jemalloc来优化mysql<br>在编译的时候加入参数：<br><figure class="highlight bash"><table><tr><td class=gutter><pre><div class=line>1</div></pre></td><td class=code><pre><div class=line>-DCMAKE_EXE_LINKER_FLAGS=<span class=string>"-ljemalloc"</span> -DWITH_SAFEMALLOC=OFF</div></pre></td></tr></table></figure></p><p>然后重新编译一遍。<br>也可以修改 /usr/local/mysql/bin/mysqld_safe<br>在# executing mysqld_safe 下面加上<br><figure class="highlight bash"><table><tr><td class=gutter><pre><div class=line>1</div></pre></td><td class=code><pre><div class=line>LD_PRELOAD=/usr/<span class=built_in>local</span>/lib/libjemalloc.so</div></pre></td></tr></table></figure></p><h2 id=4-其它配置><a href=#4-其它配置 class=headerlink title=4.其它配置></a>4.其它配置</h2><p>通常我们需要重启服务器，最好在重启服务器的时候就启动mysql<br><figure class="highlight bash"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div></pre></td><td class=code><pre><div class=line>cp support-files/mysql.server /etc/init.d/mysqld</div><div class=line>chmod a+x /etc/init.d/mysqld <span class=comment>#需要root权限</span></div></pre></td></tr></table></figure></p><p>然后将mysql添加到环境变量，修改/etc/profile文件<br><figure class="highlight bash"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div><div class=line>4</div></pre></td><td class=code><pre><div class=line>vim /etc/profile   <span class=comment>#需要root</span></div><div class=line><span class=comment>#在文件的最后面加入</span></div><div class=line><span class=comment>#mysql path</span></div><div class=line><span class=built_in>export</span> PATH=/usr/<span class=built_in>local</span>/mysql/bin:/usr/<span class=built_in>local</span>/mysql/lib:<span class=variable>$PATH</span></div></pre></td></tr></table></figure></p><p>最后执行 <code>source /etc/profile</code></p><p>随后我们也需要多数据库进行初始化操作。自 mysql5.7 开始，初始化系统表不再使用 mysql_install_db 工具, 而是使用 mysqld –initialize-insecure –user=mysql , 其中 –initialize 表示默认生成一个安全的密码, –initialize-insecure 表示不生成密码, 密码为空<br><figure class="highlight bash"><table><tr><td class=gutter><pre><div class=line>1</div></pre></td><td class=code><pre><div class=line>mysqld --initialize-insecure --user=mysql --basedir=/usr/<span class=built_in>local</span>/mysql --datadir=/usr/<span class=built_in>local</span>/mysql/data</div></pre></td></tr></table></figure></p><p>现在可以启动mysql 服务器：<br><figure class="highlight bash"><table><tr><td class=gutter><pre><div class=line>1</div></pre></td><td class=code><pre><div class=line>chkconfig mysqld on</div></pre></td></tr></table></figure></p><p>最后我们将root密码修改一下：<br><figure class="highlight bash"><table><tr><td class=gutter><pre><div class=line>1</div><div class=line>2</div><div class=line>3</div><div class=line>4</div></pre></td><td class=code><pre><div class=line>mysql -u root</div><div class=line>mysql&gt; use mysql;</div><div class=line>mysql&gt;update user <span class=built_in>set</span> authentication_string=password(<span class=string>'123456'</span>) <span class=built_in>where</span> user=<span class=string>'root'</span> and Host = <span class=string>'localhost'</span>;</div><div class=line>mysql&gt; FLUSH PRIVILEGES;</div></pre></td></tr></table></figure></p><p>特别提醒注意的一点是，新版的mysql数据库下的user表中已经没有Password字段了</p><p>而是将加密后的用户密码存储于authentication_string字段</p><h2 id=5-tips><a href=#5-tips class=headerlink title=5.tips></a>5.tips</h2><p>执行make命令的时候可以加-j（多进程）参数来加快编译速度<br>make -j “cpu 核数”</p><p>比如已知CPU是4核心的，可以使用：<br>make -j 4</p></div><div id=side-right-bar><div class=close-right-bar></div><div class=sidebar-toc><div class=sidebar-toc__title>目录</div><div class=sidebar-toc__progress><span class=progress-notice>你已经阅读了</span><span class=progress-num>0</span><span class=progress-percentage>%</span><div class=sidebar-toc__progress-bar></div></div><div class=sidebar-toc__content><ol class=toc><li class="toc-item toc-level-2"><a class=toc-link href=#1-准备工作><span class=toc-number>1.</span> <span class=toc-text>1.准备工作</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#2-准备安装><span class=toc-number>2.</span> <span class=toc-text>2.准备安装</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#3-性能调优><span class=toc-number>3.</span> <span class=toc-text>3.性能调优</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#4-其它配置><span class=toc-number>4.</span> <span class=toc-text>4.其它配置</span></a></li><li class="toc-item toc-level-2"><a class=toc-link href=#5-tips><span class=toc-number>5.</span> <span class=toc-text>5.tips</span></a></li></ol></div></div></div><div class=right-btn id=right-btn><span>目录</span></div><div class=article-bottom><div class="addthis_inline_share_toolbox fr"></div></div><div class=post-copyright><div class=post-copyright__author><span class=post-copyright-meta>文章作者:</span><span class=post-copyright-info><a href=mailto:undefined>CavinHuang</a></span></div><div class=post-copyright__type><span class=post-copyright-meta>文章链接:</span><span class=post-copyright-info><a href="http://blog.zukmb.cncentos7-源码编译安装mysql5-7/">http://blog.zukmb.cncentos7-源码编译安装mysql5-7/</a></span></div><div class=post-copyright__notice><span class=post-copyright-meta>版权声明:</span><span class=post-copyright-info>转载请注明来自<a href=http://blog.zukmb.cn target=_blank style="font-size: 18px;">CavinHuangのBlog</a>！</span></div></div><div class=article-pagenate><div class="article-prev fl"><span>←</span><a href="/Centos7硬盘挂载方法/">Centos7硬盘挂载方法</a></div><div class="article-next fr"><a href="/git-push出现git-remote-error-hook-declined-to-update/">git push出现git remote: error: hook declined to update</a><span>→</span></div></div></article></div><footer class=footer><div id=toTop style="display: none;">Back to Top</div></footer></div></div><canvas class=fireworks></canvas><script src=/js/velocity.ui.min.js></script><script src=/js/yoyo.js></script><script src=/js/scroll.js></script><script src=/js/particle.js></script><script src=/js/anime.min.js></script><script src=/js/fireworks.js></script>